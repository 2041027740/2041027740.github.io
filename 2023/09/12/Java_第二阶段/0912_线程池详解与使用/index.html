<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="未来的路就在脚下，不要悲伤不要害怕，充满信心期盼着明天。">
<meta property="og:type" content="article">
<meta property="og:title" content="线程池">
<meta property="og:url" content="http://example.com/2023/09/12/Java_%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/0912_%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="星辰可染呀">
<meta property="og:description" content="未来的路就在脚下，不要悲伤不要害怕，充满信心期盼着明天。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-09-12T14:34:29.000Z">
<meta property="article:modified_time" content="2023-11-02T03:48:38.019Z">
<meta property="article:author" content="染星辰">
<meta property="article:tag" content="线程池的创建和使用">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2023/09/12/Java_%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/0912_%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/09/12/Java_%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/0912_%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8/","path":"2023/09/12/Java_第二阶段/0912_线程池详解与使用/","title":"线程池"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>线程池 | 星辰可染呀</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">星辰可染呀</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">恰似人间惊鸿客，墨染星辰云水间</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="nav-number">1.</span> <span class="nav-text">Java线程池详解与使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0"><span class="nav-number">1.2.</span> <span class="nav-text">Java线程池的核心参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-number">1.3.</span> <span class="nav-text">创建线程池的三种方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BD%BF%E7%94%A8java-util-concurrent-Executors%E5%B7%A5%E5%8E%82%E7%B1%BB"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. 使用java.util.concurrent.Executors工厂类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8ThreadPoolExecutor%E7%B1%BB"><span class="nav-number">1.3.2.</span> <span class="nav-text">2. 直接使用ThreadPoolExecutor类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%BD%BF%E7%94%A8Spring%E6%A1%86%E6%9E%B6%E5%B0%81%E8%A3%85%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-number">1.3.3.</span> <span class="nav-text">3. 使用Spring框架封装的线程池</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">使用默认线程池</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">自定义线程池</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="nav-number">1.4.</span> <span class="nav-text">使用线程池的工具类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.5.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="染星辰"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">染星辰</p>
  <div class="site-description" itemprop="description">一生温暖纯良，不舍爱与自由</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/2041027740" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;2041027740" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/12/Java_%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/0912_%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="染星辰">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="星辰可染呀">
      <meta itemprop="description" content="一生温暖纯良，不舍爱与自由">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="线程池 | 星辰可染呀">
      <meta itemprop="description" content="未来的路就在脚下，不要悲伤不要害怕，充满信心期盼着明天。">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          线程池
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-12 22:34:29" itemprop="dateCreated datePublished" datetime="2023-09-12T22:34:29+08:00">2023-09-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-02 11:48:38" itemprop="dateModified" datetime="2023-11-02T11:48:38+08:00">2023-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">每日一题</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">未来的路就在脚下，不要悲伤不要害怕，充满信心期盼着明天。</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="Java线程池详解与使用"><a href="#Java线程池详解与使用" class="headerlink" title="Java线程池详解与使用"></a>Java线程池详解与使用</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>在并发处理任务时，使用多线程技术是一种常见的方法。通常情况下，我们会通过<code>new Thread()</code>来创建新线程来实现并发执行任务。然而，这种方法存在一些弊端：</p>
<ul>
<li>频繁创建和销毁线程会耗费性能和资源。</li>
<li>新线程创建后可能仅执行一些简单任务后就销毁，无法复用。</li>
<li>大量任务短时间内到达时，线程的大规模创建可能导致性能瓶颈、资源占用过多或内存溢出等问题，降低系统稳定性。</li>
</ul>
<p>为了解决这些问题，通常会使用线程池。线程池具有以下好处：</p>
<ul>
<li>降低系统资源消耗。</li>
<li>提高系统响应速度。</li>
<li>方便线程管理。</li>
</ul>
<p>Java中有多种创建和使用线程池的方法，主要有以下三种：</p>
<ol>
<li>使用Java标准库中<code>java.util.concurrent.Executors</code>工厂类。</li>
<li>直接使用<code>ThreadPoolExecutor</code>类。</li>
<li>使用Spring框架封装的线程池，底层也是对 <code>ThreadPoolExecutor</code> 的封装。</li>
</ol>
<h2 id="Java线程池的核心参数"><a href="#Java线程池的核心参数" class="headerlink" title="Java线程池的核心参数"></a>Java线程池的核心参数</h2><p>在线程池创建时，需要指定一些关键参数，共有七个参数：</p>
<ol>
<li><p><code>corePoolSize</code>：核心线程数，线程池中一直存在的线程数量。</p>
</li>
<li><p><code>maximumPoolSize</code>：最大线程数，线程池允许的最大线程数量。</p>
</li>
<li><p><code>keepAliveTime</code>：空闲线程存活时间，即线程在空闲一段时间后会被回收。</p>
</li>
<li><p><code>TimeUnit</code>：时间单位，表示<code>keepAliveTime</code>的时间单位。</p>
<blockquote>
<p>枚举类型。通常取值：</p>
<ul>
<li><code>TimeUnit.NANOSECONDS;</code> 纳秒</li>
<li><code>TimeUnit.MICROSECONDS;</code> 微秒</li>
<li><code>TimeUnit.MILLISECONDS;</code> 毫秒</li>
<li><code>TimeUnit.SECONDS;</code> 秒</li>
<li><code>TimeUnit.MINUTES;</code> 分</li>
<li><code>TimeUnit.HOURS;</code> 时</li>
<li><code>TimeUnit.DAYS;</code> 天</li>
</ul>
</blockquote>
</li>
<li><p><code>BlockingQueue</code>：线程池任务队列，用于存储等待执行的任务。</p>
<blockquote>
<p>当线程池中的线程都在忙碌时，新提交的任务会被放入队列中等待执行。可传的值可以是不同类型的阻塞队列：</p>
<ul>
<li><code>new ArrayBlockingQueue&lt;Runnable/Callable&gt;():</code> <code>ArrayBlockingQueue</code>, 一个由数组结构组成的<strong>有界阻塞队列</strong>。</li>
<li><code>new LinkedBlockingQueue&lt;Runnable/Callable&gt;(): ``LinkedBlockingQueue</code>, 一个由链表结构组成的<strong>有界阻塞队列</strong>。</li>
<li><code>new SynchronousQueue&lt;Runnable/Callable&gt;():</code> <code>SynchronousQueue</code>, 一个不存储元素的阻塞队列，即直接提交给线程不保持它们。</li>
<li><code>new PriorityBlockingQueue&lt;Runnable/Callable&gt;():</code> <code>PriorityBlockingQueue</code>, 一个支持优先级排序的<strong>无界阻塞队列</strong>。</li>
<li><code>new DelayQueue&lt;Runnable/Callable&gt;():</code> <code>DelayQueue</code>：一个使用优先级队列实现的<strong>无界阻塞队列</strong>，只有在延迟期满时才能从中提取元素。</li>
<li><code>new LinkedTransferQueue&lt;Runnable/Callable&gt;():</code> <code>LinkedTransferQueue</code>, 一个由链表结构组成的<strong>无界阻塞队列</strong>。与 <code>SynchronousQueue</code> 类似，还含有非阻塞方法。</li>
<li><code>new LinkedBlockingDeque&lt;Runnable/Callable&gt;():</code> <code>LinkedBlockingDeque</code>, 一个由链表结构组成的<strong>双向阻塞队列</strong>。</li>
</ul>
<p>比较常用的是 <code>LinkedBlockingQueue</code>，线程池的排队策略和 <code>BlockingQueue</code> 息息相关。</p>
</blockquote>
</li>
<li><p><code>ThreadFactory</code>：创建线程的工厂。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义线程工厂类</span></span><br><span class="line"><span class="comment">//实现ThreadFactory接口，并重写里面的newThread方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThreadFactory</span> <span class="keyword">implements</span> <span class="title class_">ThreadFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建并返回自定义的线程对象</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置线程名称</span></span><br><span class="line">        thread.setName(<span class="string">&quot;Thread-&quot;</span> + r.hashCode());</span><br><span class="line">        <span class="comment">// 设置线程优先级（最大值：10）</span></span><br><span class="line">       thread.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">        <span class="comment">// 设置线程的守护状态</span></span><br><span class="line">        thread.setDaemon(<span class="literal">false</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 返回新线程</span></span><br><span class="line">        <span class="keyword">return</span> thread;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者使用lambda表达式完成传参</span></span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">threadPoolExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">10</span>, <span class="number">20</span>, <span class="number">3000l</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">200</span>), r -&gt; &#123;</span><br><span class="line">         <span class="comment">// 创建并返回自定义的线程对象</span></span><br><span class="line">         <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">         <span class="comment">// 设置线程名称</span></span><br><span class="line">         thread.setName(<span class="string">&quot;Thread-&quot;</span> + r.hashCode());</span><br><span class="line">         <span class="comment">// 设置线程优先级（最大值：10）</span></span><br><span class="line">         thread.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">         <span class="comment">// 设置线程的守护状态</span></span><br><span class="line">         thread.setDaemon(<span class="literal">false</span>);</span><br><span class="line">         <span class="comment">// 返回新线程</span></span><br><span class="line">         <span class="keyword">return</span> thread;</span><br><span class="line">     &#125;);</span><br></pre></td></tr></table></figure>


</li>
<li><p><code>RejectedExecutionHandler</code>：拒绝策略，定义当线程池无法接受新任务时应采取的策略。</p>
<blockquote>
<p>这个参数用于定义在出现这种情况时应采取的策略。可传的值通常是预定义的策略，如：</p>
<ul>
<li><code>ThreadPoolExecutor.AbortPolicy</code>：拒绝并抛出异常。(默认为这种)</li>
<li><code>ThreadPoolExecutor.CallerRunsPolicy</code>：使用当前调用的线程来执行此任务。</li>
<li><code>ThreadPoolExecutor.DiscardOldestPolicy</code>：抛弃队列头部（最旧）的一个任务，并执行当前任务。</li>
<li><code>ThreadPoolExecutor.DiscardPolicy</code>：忽略并抛弃当前任务。</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="创建线程池的三种方式"><a href="#创建线程池的三种方式" class="headerlink" title="创建线程池的三种方式"></a>创建线程池的三种方式</h2><h3 id="1-使用java-util-concurrent-Executors工厂类"><a href="#1-使用java-util-concurrent-Executors工厂类" class="headerlink" title="1. 使用java.util.concurrent.Executors工厂类"></a>1. 使用<code>java.util.concurrent.Executors</code>工厂类</h3><p>Java标准库提供了一些静态方法来创建常见类型的线程池，包括：</p>
<ul>
<li><p><code>newCachedThreadPool()</code>：创建一个可根据需要自动扩展的线程池。</p>
<blockquote>
<p>特点:</p>
<ol>
<li>维护了一个可自动扩容的线程容器，每当需要执行一个新任务时，有活跃的线程就使用该线程，否则就新建一条线程。</li>
<li>线程池的最大线程数为Integer.MAX_VALUE，基本上不受限制。</li>
<li>使用完毕后的线程会回归线程池，如果这个线程在60秒之后依旧空闲，那么就会被移除</li>
<li>线程池初始线程个数为0</li>
</ol>
<p>适用于线程生命周期短且频繁创建的场景</p>
</blockquote>
</li>
<li><p><code>newFixedThreadPool(int nThreads)</code>：创建一个固定线程数量的线程池。</p>
<blockquote>
<p>特点:</p>
<ol>
<li>创建一个固定线程数量的线程池，在整个线程池的生命周期中，线程池中的数量不会变化</li>
<li>维护一个无界队列（暂存已提交的来不及执行的任务）按照任务的提交顺序，将任务执行完毕</li>
</ol>
<p>这种类型的线程池适用于执行长时任务或需要限制并发数量的场景。</p>
</blockquote>
</li>
<li><p><code>newSingleThreadExecutor()</code>：创建一个仅包含一个线程的线程池。</p>
<blockquote>
<p>特点:</p>
<ol>
<li>线程数量固定为1个，在整个线程池的生命周期中，线程池中的数量不会变化</li>
<li>维护了一个无界队列（暂存已提交的来不及执行的任务）按照任务的提交顺序，将任务执行完毕</li>
</ol>
<p>这种类型的线程池适用于需要保证任务顺序执行，不需要同时执行的场景</p>
</blockquote>
</li>
</ul>
<p>其中无界队列指的是一个不确定长度的可自由扩容的队列，遵循” 先进先出” 的特点，理论上可以容量无限的任务。<br>使用以上方法就可以得到一个具有相应特点的线程池对象，具体情况使用哪个线程池要具体分析。<br>上面通过 <code>Executors</code> 创建的线程池，返回的是一个实现了 <code>ExecutorService</code> 接口的线程池，我们通常使用这个接口来承接返回的线程池，我们可以通过这个接口中的一系列方法来操作管理线程池，比如提交任务，关闭线程池等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//提交一个Runnable类型的任务(实现了Runnable接口，并重写了run方法的任务)，任务的执行没有返回值，可以不接返回值</span></span><br><span class="line">Future&lt;?&gt; submit(Runnable task);</span><br><span class="line"></span><br><span class="line"><span class="comment">//提交一个Callable类型的任务(实现了Callable接口，并重写而来call方法的任务)，任务的执行有返回值，返回值封装在一个Future&lt;T&gt;类型的值中，通过其中的get()方法获得</span></span><br><span class="line">Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Callable&lt;T&gt; task)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行完任务列表中所有已提交的任务，关闭线程池，不再接受新任务。</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 立刻停止所有正在执行的活动任务，也不再处理任务列表中等待的任务，并直接返回等待执行的任务列表。</span></span><br><span class="line">List&lt;Runnable&gt; <span class="title function_">shutdownNow</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>阿里巴巴 <code>Java</code> 开发规范手册中，就明确禁止用这种方式来新建线程池。</p>
</li>
<li><p>主要原因：</p>
<ul>
<li><p>无界队列。<code>Executors.newFixedThreadPool</code> 固定容量线程池和 <code>Executors.newSingleThreadExecutor</code> 单个容量线程池都会创建一个无界的队列来支持任务提交。也就是说，只要不停的往线程池提交任务，这个任务队列就会不断变长。如果因一些意外问题导致任务处理速度完全跟不上提交速度，程序有堆溢出<code>（OutOfMemoryError）</code>的风险。</p>
</li>
<li><p>无限的线程对象。<code>Executors.newCachedThreadPool</code> 会创建一个线程数量可以无限制增长的线程池，实际上该线程池的线程容量最大值是 <code>Integer.MAX_VALUE</code>。这显然也是很有风险的事情，可能浪费大量线程资源，影响程序的效率。</p>
</li>
<li><p>配置不灵活：<code>Executors</code> 工具类提供的方法创建的线程池，其线程数、队列策略等参数都是固定的，无法根据系统的实际需要进行调整。实际上，线程池的配置应该根据硬件条件，实际任务需求等灵活调整。</p>
</li>
</ul>
</li>
</ul>
<h3 id="2-直接使用ThreadPoolExecutor类"><a href="#2-直接使用ThreadPoolExecutor类" class="headerlink" title="2. 直接使用ThreadPoolExecutor类"></a>2. 直接使用<code>ThreadPoolExecutor</code>类</h3><p>可以直接创建<code>ThreadPoolExecutor</code>对象，自定义线程池的参数，如<code>corePoolSize</code>、<code>maximumPoolSize</code>、<code>keepAliveTime</code>、<code>BlockingQueue</code>、<code>ThreadFactory</code>和<code>RejectedExecutionHandler</code>等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">javaCopy <span class="type">codeThreadPoolExecutor</span> <span class="variable">threadPoolExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    corePoolSize,</span><br><span class="line">    maximumPoolSize,</span><br><span class="line">    keepAliveTime,</span><br><span class="line">    TimeUnit,</span><br><span class="line">    BlockingQueue,</span><br><span class="line">    ThreadFactory,</span><br><span class="line">    RejectedExecutionHandler</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用ThreadPoolExecutor手动创建线程池，并提交任务</span></span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">threadPoolExecutor1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">20</span>,</span><br><span class="line">             <span class="number">50</span>,</span><br><span class="line">             <span class="number">600L</span>,</span><br><span class="line">             TimeUnit.SECONDS,</span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">200</span>),</span><br><span class="line">             r -&gt; &#123;</span><br><span class="line">                 <span class="comment">// 创建并返回自定义的线程对象</span></span><br><span class="line">                 <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">                 <span class="comment">// 设置线程名称</span></span><br><span class="line">                 thread.setName(<span class="string">&quot;Thread-&quot;</span> + r.hashCode());</span><br><span class="line">                 <span class="comment">// 设置线程优先级（最大值：10）</span></span><br><span class="line">                 thread.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">                 <span class="comment">// 设置线程的守护状态</span></span><br><span class="line">                 thread.setDaemon(<span class="literal">false</span>);</span><br><span class="line">                 <span class="comment">// 返回新线程</span></span><br><span class="line">                 <span class="keyword">return</span> thread;</span><br><span class="line">             &#125;,</span><br><span class="line">             <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());</span><br><span class="line">             </span><br><span class="line">     <span class="comment">//提交任务</span></span><br><span class="line">     <span class="comment">//提交Runnable任务</span></span><br><span class="line">     threadPoolExecutor1.submit(() -&gt; System.out.println(<span class="string">&quot;你好朋友！&quot;</span>));</span><br><span class="line">     <span class="comment">//提交Callable任务</span></span><br><span class="line">     System.out.println(threadPoolExecutor1.submit(() -&gt; <span class="string">&quot;你好呀朋友！！&quot;</span>).get());</span><br></pre></td></tr></table></figure>

<h3 id="3-使用Spring框架封装的线程池"><a href="#3-使用Spring框架封装的线程池" class="headerlink" title="3. 使用Spring框架封装的线程池"></a>3. 使用Spring框架封装的线程池</h3><p><code>Spring</code> 框架也基于 <code>ThreadPoolExecutor</code> 封装了一个线程池，在 <code>Spring</code> 框架的应用中的使用上更加简便。</p>
<h4 id="使用默认线程池"><a href="#使用默认线程池" class="headerlink" title="使用默认线程池"></a>使用默认线程池</h4><ol>
<li>在启动类上添加<code>@EnableAsync</code>注解。</li>
<li>在需要异步处理的方法上添加<code>@Async</code>注解。</li>
<li>注入<code>ThreadPoolTaskExecutor</code>组件，该组件是 <code>Spring</code> 框架在加载容器的时候自动创建并注册到容器中的，可直接使用它往Spring默认的线程池中提交任务。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPoolApplicationTestsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ThreadPoolApplicationTestsService</span> &#123;</span><br><span class="line">    <span class="comment">//直接注入即可使用</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ThreadPoolTaskExecutor threadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//往Spring自带的线程池中提交任务，获得返回结果，并打印</span></span><br><span class="line">        System.out.println(threadPoolTaskExecutor.submit(() -&gt; <span class="string">&quot;你好呀小朋友！！&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//往Spring自带的线程池中提交任务，获得返回结果，并打印</span></span><br><span class="line">        System.out.println(threadPoolTaskExecutor.submit(() -&gt; <span class="string">&quot;你好呀大朋友！！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自定义线程池"><a href="#自定义线程池" class="headerlink" title="自定义线程池"></a>自定义线程池</h4><p>利用 <code>SpringBoot</code> 的自动装配的功能，配置一个自定义的线程池，并注册到容器中，供其他的组件注入使用。</p>
<ol>
<li><p>在配置文件中配置线程池的参数。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  task.pool.corePoolSize=50</span></span><br><span class="line"><span class="comment">#  task.pool.maxPoolSize=100</span></span><br><span class="line"><span class="comment">#  task.pool.keepAliveSeconds=3000</span></span><br><span class="line"><span class="comment">#  task.pool.queueCapacity=100</span></span><br><span class="line"><span class="attr">task:</span></span><br><span class="line">  <span class="attr">pool:</span></span><br><span class="line">    <span class="attr">core-size:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">max-size:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">keep-alive:</span> <span class="number">3000</span></span><br><span class="line">    <span class="attr">queue-capacity:</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个读取配置文件中参数的配置类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tzjw.marketweixin.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 线程池参数类</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Xiaobin</span></span><br><span class="line"><span class="comment">* <span class="doctag">@since</span> 2023/09/21 09:55</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;task.pool&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPoolProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> coreSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxSize;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> keepAlive;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> queueCapacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个线程池配置类，修改默认线程池的配置，将自定义的线程池注册到容器中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tzjw.marketweixin.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.AsyncConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 线程池配置类</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Xiaobin</span></span><br><span class="line"><span class="comment">* <span class="doctag">@since</span> 2023/09/21 09:59</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ThreadPoolProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaskExecutePool</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolProperties threadPoolProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改默认线程池的配置,将自定义的线程池注册到容器中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ThreadPoolTaskExecutor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="keyword">public</span> ThreadPoolTaskExecutor <span class="title function_">myThreadPoolTaskExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">         <span class="comment">// 核心线程数</span></span><br><span class="line">         executor.setCorePoolSize(threadPoolProperties.getCoreSize());</span><br><span class="line">         <span class="comment">// 最大线程数</span></span><br><span class="line">         executor.setMaxPoolSize(threadPoolProperties.getMaxSize());</span><br><span class="line">         <span class="comment">// 非核心线程活跃时间</span></span><br><span class="line">         executor.setKeepAliveSeconds(threadPoolProperties.getKeepAlive());</span><br><span class="line">         <span class="comment">// 队列容量</span></span><br><span class="line">         executor.setQueueCapacity(threadPoolProperties.getQueueCapacity());</span><br><span class="line">         <span class="comment">// 设置线程的前缀名</span></span><br><span class="line">         executor.setThreadNamePrefix(<span class="string">&quot;market&quot;</span>);</span><br><span class="line">         <span class="comment">// 设置拒绝策略</span></span><br><span class="line">         executor.setRejectedExecutionHandler(<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line">         <span class="comment">// 是否在任务执行完后关闭线程池</span></span><br><span class="line">         executor.setWaitForTasksToCompleteOnShutdown(<span class="literal">false</span>);</span><br><span class="line">         <span class="comment">//初始化</span></span><br><span class="line">         executor.initialize();</span><br><span class="line">         <span class="keyword">return</span> executor;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>为了方便往线程池中提交任务，我们还可以写一个工具类，注册到容器中，简化提交任务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tzjw.marketweixin.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tzjw.marketweixin.config.TaskExecutePool;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.task.TaskExecutor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.AsyncResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 使用线程池的工具类</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Xiaobin</span></span><br><span class="line"><span class="comment">* <span class="doctag">@since</span> 2023/09/21 10:25</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringThreadPoolUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   ThreadPoolTaskExecutor taskExecutor;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 往线程池中提交任务</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> task</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> java.util.concurrent.Future&lt;T&gt;</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@author</span> Xiaobin</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@since</span> 2023/09/21 16:46</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Future&lt;T&gt; <span class="title function_">submitTask</span><span class="params">(Callable&lt;T&gt; task)</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> taskExecutor.submit(task);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Error submitting task to the thread pool.&quot;</span>, e);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过上面的封装之后，我们后续只需要在项目中引入 <code>SpringThreadPoolUtil</code> 这个组件，调用其中的 <code>submitTask</code> 方法，传入一个 <code>Callable</code> 类型的任务就可以向线程池中提交任务，并获得返回值。具体的使用实例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HomeIndexServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">HomeIndexService</span> &#123;</span><br><span class="line">   <span class="comment">//注入工具类对象</span></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   SpringThreadPoolUtil springThreadPoolUtil;</span><br><span class="line">      </span><br><span class="line">   <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getIndexData</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// 使用线程池提交数据库查询任务</span></span><br><span class="line">       Future&lt;List&gt; adFuture = springThreadPoolUtil.submitTask(() -&gt; &#123;</span><br><span class="line">           <span class="type">MarketAdExample</span> <span class="variable">marketAdExample</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MarketAdExample</span>();</span><br><span class="line">           marketAdExample.setOrderByClause(<span class="string">&quot;add_time desc&quot;</span>);</span><br><span class="line">           marketAdExample.createCriteria().andDeletedEqualTo(<span class="literal">false</span>);</span><br><span class="line">           <span class="keyword">return</span> marketAdMapper.selectByExample(<span class="keyword">new</span> <span class="title class_">MarketAdExample</span>());</span><br><span class="line">       &#125;); </span><br><span class="line">       <span class="comment">//解析</span></span><br><span class="line">       List&lt;MarketAd&gt; = adFuture.get();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="使用线程池的工具类"><a href="#使用线程池的工具类" class="headerlink" title="使用线程池的工具类"></a>使用线程池的工具类</h2><p>为了更方便地向线程池提交任务，可以创建一个工具类，将线程池的提交任务操作封装起来。下面是一个示例工具类的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">javaCopy code@Component</span><br><span class="line">public class SpringThreadPoolUtil &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    ThreadPoolTaskExecutor taskExecutor;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Future&lt;T&gt; submitTask(Callable&lt;T&gt; task) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return taskExecutor.submit(task);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;Error submitting task to the thread pool.&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上述工具类，可以在业务代码中轻松地往线程池中提交任务，并获得返回值，实现并行处理任务。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>使用线程池是提高并发处理性能和资源利用率的重要方法之一。本文介绍了Java线程池的核心参数、创建线程池的三种方式以及Spring框架中的线程池使用方法。选择合适的线程池类型和配置参数可以更好地满足不同应用场景的需求，提高系统的稳定性和性能。</p>
<p>希望本文对你理解和使用Java线程池有所帮助！</p>

    </div>

    
    
    
	
	 
   <div>
     <div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
   </div>
 
	

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>染星辰
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://example.com/2023/09/12/Java_%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5/0912_%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3%E4%B8%8E%E4%BD%BF%E7%94%A8/" title="线程池">http://example.com/2023/09/12/Java_第二阶段/0912_线程池详解与使用/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8/" rel="tag"># 线程池的创建和使用</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/09/10/Java_%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="prev" title="单例模式">
                  <i class="fa fa-angle-left"></i> 单例模式
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/10/07/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/0907_session%E5%92%8Ccookie%E7%9A%84%E5%8C%BA%E5%88%AB%20-%20%E5%89%AF%E6%9C%AC/" rel="next" title="session和cookie的区别">
                  session和cookie的区别 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC81ODg4OS8zNTM1MQ=="></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">染星辰</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div> -->







    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script src="/js/third-party/comments/livere.js"></script>

</body>
</html>
